@page "/analyze"

<button class="btn btn-primary btn-sm py-0" onclick="renderChartTest()">Click me</button>

<h4>栄養素分析</h4>
<div class="row">
    <div class="col-12">
        <p>50g, 1.4mg, 2.3mg, 5mg, 18g, 10mg, 750mg</p>
        <div class="chart-container" style="position:relative; max-width: 800px">
            <canvas id="eiyoChart"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <p>浮動棒グラフ</p>
        <div class="chart-container" style="position:relative; max-width: 500px">
            <canvas id="SuiminChart"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <p>歩数グラフ</p>
        <div class="chart-container" style="position:relative; max-width: 500px">
            <canvas id="HosuuChart"></canvas>
        </div>
    </div>
</div>


<script>
    renderEiyoChart();
    renderSuiminTimeChart();
    renderHosuuChart();

    function renderHosuuChart() {
        renderChart(
            {
                type: "bar",
                data: {
                    labels: ["7/1","7/2","7/3","7/4","7/5","7/6"],
                    datasets: [
                        {
                            label:"",
                            data: [1,2,3,4,5,6],
                            backgroundColor: [
                                "rgba(54, 162, 235, 0.9)",
                                "rgba(54, 162, 235, 0.9)",
                                "rgba(54, 162, 235, 0.9)",
                                "rgba(54, 162, 235, 0.9)",
                                "rgba(54, 162, 235, 0.9)",
                                "rgba(54, 162, 235, 0.9)"
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    plugins: {
                    legend: {
                        display:false
                    },
                    title: {
                        display:false
                        }
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                min: 0, // 最小値
                                stepSize: 1 // メモリの間隔
                                }
                        }]
                    }
                }
        }
            , "HosuuChart");
    }
    
    function renderSuiminTimeChart() {
    
        var sleepData = [
            { sleep: moment('2024-08-01T23:00:00'), wake: moment('2024-08-02T07:00:00') },
            { sleep: moment('2024-08-02T23:30:00'), wake: moment('2024-08-03T06:30:00') },
            { sleep: moment('2024-08-03T23:00:00'), wake: moment('2024-08-04T07:00:00') },
            // 他の日付のデータ...
        ];
        var chartData = sleepData.map(function (item, index) {
            return {
                x: `Day ${index + 1}`,
                y: item.sleep.valueOf(),
                y2: item.wake.valueOf()
            };
        });
        const data = {
            labels: chartData.map(item => item.x),
            datasets:[{
                label: '睡眠時間',
                data: chartData.map(item => 
                    (item.y2 - item.y) / (1000 * 60 * 60)  // ミリ秒を時間に変換
                ),
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                fill:true
            }]
        };
    
        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false,
                    },
                    title: {
                        display: false,
                    },
                },
                scales:{
                    y:{
                        min:0,
                        max:12,
                        ticks:{
                            stepSize:2
                        }
                    }
                }
            },
        };

        renderChart(config,"SuiminChart");
        console.debug(data);
    }

    function renderEiyoChart() {
        renderChart(
           {
                type: "radar",
                data: {
                    labels: ["タンパク質", "食物繊維", "ビタミンB6", "ビタミンB12", "鉄分", "亜鉛","カルシウム"],
                    datasets: [
                        {
                            label: "推定必要栄養素",
                            data: [1,1,1,1,1,1,0.8],
                            backgroundColor: [
                                "rgba(255, 99, 132, 0.2)",
                                "rgba(54, 162, 235, 0.2)",
                                "rgba(255, 206, 86, 0.2)",
                                "rgba(75, 192, 192, 0.2)",
                                "rgba(153, 102, 255, 0.2)",
                                "rgba(255, 159, 64, 0.2)"
                            ],
                            borderColor: [
                                "rgba(255, 99, 132, 1)",
                                "rgba(54, 162, 235, 1)",
                                "rgba(255, 206, 86, 1)",
                                "rgba(75, 192, 192, 1)",
                                "rgba(153, 102, 255, 1)",
                                "rgba(255, 159, 64, 1)"
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    scales:{
                        r:{
                            min:0,
                            max:1.2,
                        }
                    }
                }
            }
            , "eiyoChart");
    }

</script>

@code {

}