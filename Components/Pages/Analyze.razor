@page "/analyze"
<div class="row">
    <div class="col-3">
        <button class="btn btn-primary btn-sm py-0" onclick="renderChartTest()">Click me</button>
    </div>    
</div>

<h4>栄養素分析</h4>

<div class="row">
    <div class="col-12">
        <p>不足しがちな栄養素の推定必要摂取量と推定摂取量の比率</p>
        <div class="chart-container" style="position:relative; max-width: 800px">
            <canvas id="eiyoChart"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <p>折れ線グラフ</p>
        <div class="chart-container" style="position:relative; max-width: 500px">
            <canvas id="SuiminChart"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <p>歩数グラフ</p>
        <div class="chart-container" style="position:relative; max-width: 500px">
            <canvas id="HosuuChart"></canvas>
        </div>
    </div>
</div>


<script>
    renderEiyoChart();
    renderSuiminTimeChart();
    renderHosuuChart();

    function renderHosuuChart() {
        renderChart(
            {
                type: "bar",
                data: {
                    labels: ["7/1","7/2","7/3","7/4","7/5","7/6","7/7","7/8","7/92","7/10","7/11","7/12","7/13","7/14","7/15"],
                    datasets: [
                        {
                            label:"",
                            data: [228,130,372,262,376,221,350,860,475,542,382,401,526,123,451,],
                            backgroundColor: [
                                "rgba(54, 162, 235, 0.9)"
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    plugins: {
                    legend: {
                        display:false
                    },
                    title: {
                        display:false
                        }
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                min: 0, // 最小値
                            }
                        }]
                    }
                }
        }
            , "HosuuChart");
    }
    
    function renderSuiminTimeChart() {
    
        var sleepData = [
            { sleep: moment('2024-08-01T23:00:00'), wake: moment('2024-08-02T07:00:00') },
            { sleep: moment('2024-08-02T23:30:00'), wake: moment('2024-08-03T06:30:00') },
            { sleep: moment('2024-08-03T23:00:00'), wake: moment('2024-08-04T07:00:00') },
            { sleep: moment('2024-08-04T21:30:00'), wake: moment('2024-08-05T05:20:00') },
            { sleep: moment('2024-08-05T21:50:00'), wake: moment('2024-08-06T06:00:00') },
            { sleep: moment('2024-08-07T03:20:00'), wake: moment('2024-08-07T06:50:00') },
            { sleep: moment('2024-08-08T01:20:00'), wake: moment('2024-08-08T09:50:00') },
            { sleep: moment('2024-08-08T22:45:00'), wake: moment('2024-08-09T05:20:00') },
            { sleep: moment('2024-08-09T23:50:00'), wake: moment('2024-08-10T05:30:00') },
            // 他の日付のデータ...
        ];
        var chartData = sleepData.map(function (item, index) {
            return {
                x: `Day ${index + 1}`,
                y: item.sleep.valueOf(),
                y2: item.wake.valueOf()
            };
        });
        const data = {
            labels: chartData.map(item => item.x),
            datasets:[{
                label: '睡眠時間',
                data: chartData.map(item => 
                    (item.y2 - item.y) / (1000 * 60 * 60)  // ミリ秒を時間に変換
                ),
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                fill:true
            }]
        };
    
        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false,
                    },
                    title: {
                        display: false,
                    },
                },
                scales:{
                    y:{
                        min:0,
                        max:12,
                        ticks:{
                            stepSize:2
                        }
                    }
                }
            },
        };

        renderChart(config,"SuiminChart");
        console.debug(data);
    }

    function renderEiyoChart() {
        renderChart(
           {
                type: "radar",
                data: {
                    labels: ["タンパク質", "食物繊維", "ビタミンB6", "ビタミンB12", "鉄分", "亜鉛","カルシウム"],
                    datasets: [
                        {
                            label: "推定必要栄養素",
                            data: [1,1,1,1,1,1,1],
                            backgroundColor: [
                                "rgba(0, 0, 0, 0)"
                            ],
                            borderColor: [
                                "rgba(255, 99, 132, 0.7)"
                            ],
                            borderWidth: 1
                        },
                        {
                            label: "あなたの推定摂取栄養素",
                            data: [0.9,0.8,0.91,1.01,0.98,0.86,0.65],
                            backgroundColor: [
                                "rgba(54, 162, 235, 0.2)"
                            ],
                            borderColor: [
                                "rgba(54, 162, 235, 1)"
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    scales:{
                        r:{
                            min:0,
                            max:1.2,
                        }
                    }
                }
            }
            , "eiyoChart");
    }

</script>

@code {
    
}